<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Tutorial ¬∑ TulipaClustering.jl</title><meta name="title" content="Tutorial ¬∑ TulipaClustering.jl"/><meta property="og:title" content="Tutorial ¬∑ TulipaClustering.jl"/><meta property="twitter:title" content="Tutorial ¬∑ TulipaClustering.jl"/><meta name="description" content="Documentation for TulipaClustering.jl."/><meta property="og:description" content="Documentation for TulipaClustering.jl."/><meta property="twitter:description" content="Documentation for TulipaClustering.jl."/><meta property="og:url" content="https://TulipaEnergy.github.io/TulipaClustering.jl/10-tutorial/"/><meta property="twitter:url" content="https://TulipaEnergy.github.io/TulipaClustering.jl/10-tutorial/"/><link rel="canonical" href="https://TulipaEnergy.github.io/TulipaClustering.jl/10-tutorial/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="TulipaClustering.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">TulipaClustering.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Welcome</a></li><li class="is-active"><a class="tocitem" href>Tutorial</a><ul class="internal"><li><a class="tocitem" href="#Getting-Started"><span>Getting Started</span></a></li><li><a class="tocitem" href="#hull_clustering"><span>Hull Clustering with Blended Representative Periods</span></a></li><li><a class="tocitem" href="#Clustering-by-other-columns"><span>Clustering by other columns</span></a></li><li><a class="tocitem" href="#custom_layout"><span>Using a Custom Layout</span></a></li><li><a class="tocitem" href="#Extra-Functions-in-High-level-API/DuckDB-API"><span>Extra Functions in High level API/DuckDB API</span></a></li><li><a class="tocitem" href="#Low-level-API"><span>Low level API</span></a></li></ul></li><li><a class="tocitem" href="../20-concepts/">Concepts</a></li><li><a class="tocitem" href="../80-scientific-references/">Scientific References</a></li><li><a class="tocitem" href="../90-contributing/">Contributing guidelines</a></li><li><a class="tocitem" href="../91-developer/">Developer documentation</a></li><li><a class="tocitem" href="../95-reference/">Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Tutorial</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Tutorial</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/TulipaEnergy/TulipaClustering.jl/blob/main/docs/src/10-tutorial.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid">ÔÅÑ</span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Tutorial"><a class="docs-heading-anchor" href="#Tutorial">Tutorial</a><a id="Tutorial-1"></a><a class="docs-heading-anchor-permalink" href="#Tutorial" title="Permalink"></a></h1><ul><li><a href="#Getting-Started">Getting Started</a></li><li class="no-marker"><ul><li><a href="#Input-files">Input files</a></li><li><a href="#Clustering">Clustering</a></li><li><a href="#Output-Tables">Output Tables</a></li></ul></li><li><a href="#hull_clustering">Hull Clustering with Blended Representative Periods</a></li><li><a href="#Clustering-by-other-columns">Clustering by other columns</a></li><li><a href="#custom_layout">Using a Custom Layout</a></li><li><a href="#Extra-Functions-in-High-level-API/DuckDB-API">Extra Functions in High level API/DuckDB API</a></li><li class="no-marker"><ul><li><a href="#Dummy-Clustering">Dummy Clustering</a></li><li><a href="#Transform-a-wide-profiles-table-into-a-long-table">Transform a wide profiles table into a long table</a></li></ul></li><li><a href="#Low-level-API">Low level API</a></li></ul><h2 id="Getting-Started"><a class="docs-heading-anchor" href="#Getting-Started">Getting Started</a><a id="Getting-Started-1"></a><a class="docs-heading-anchor-permalink" href="#Getting-Started" title="Permalink"></a></h2><h3 id="Input-files"><a class="docs-heading-anchor" href="#Input-files">Input files</a><a id="Input-files-1"></a><a class="docs-heading-anchor-permalink" href="#Input-files" title="Permalink"></a></h3><p>We use <a href="https://duckdb.org/">DuckDB</a> as the database backend for the input data of the profiles. The input data must be in a long table format with at least the columns <code>year</code>, <code>profile_name</code>, <code>timestep</code>, and <code>value</code>. Extra columns such as <code>scenario</code> are allowed. These defaults values are configurable by passing a <a href="../95-reference/#TulipaClustering.ProfilesTableLayout"><code>ProfilesTableLayout</code></a> to <a href="../95-reference/#TulipaClustering.cluster!-Tuple{Any, Any, Any}"><code>cluster!</code></a>. See the <a href="#custom_layout">Using a Custom Layout</a> section for an example of how to use a custom layout.</p><p>For this tutorial we will use the <a href="https://github.com/TulipaEnergy/TulipaClustering.jl/blob/main/test/inputs/EU/profiles.csv">profiles file</a> available in the TulipaClustering repository.</p><p>In this example the profiles are in a CSV file, but you can also load them from other sources (e.g., Parquet, Excel, etc.) using DuckDB&#39;s <a href="https://duckdb.org/docs/stable/data/data_sources">readers</a>.</p><pre><code class="language-julia hljs">using DataFrames, DuckDB

# change the following path to your file location
profiles_file = joinpath(@__DIR__,&quot;../../test/inputs/EU/profiles.csv&quot;)

connection = DBInterface.connect(DuckDB.DB)
DuckDB.query(
  connection,
  &quot;&quot;&quot;
  CREATE TABLE profiles AS
  SELECT * FROM read_csv(&#39;$profiles_file&#39;);
  &quot;&quot;&quot;,
)

# helper function to query the DuckDB tables in the connection
nice_query(str) = DuckDB.query(connection, str) |&gt; DataFrame

# show the tables in the connection using the helper function
nice_query(&quot;SHOW tables&quot;)</code></pre><div><div style = "float: left;"><span>1√ó1 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">name</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "String" style = "text-align: left;">String</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: left;">profiles</td></tr></tbody></table></div><p>And here we can have a look at the first rows of <code>profiles</code>:</p><pre><code class="language-julia hljs">nice_query(&quot;FROM profiles LIMIT 10&quot;)</code></pre><div><div style = "float: left;"><span>10√ó4 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">year</th><th style = "text-align: left;">profile_name</th><th style = "text-align: left;">timestep</th><th style = "text-align: left;">value</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "String" style = "text-align: left;">String</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Float64" style = "text-align: left;">Float64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: right;">2030</td><td style = "text-align: left;">AUS_SunPV</td><td style = "text-align: right;">1</td><td style = "text-align: right;">0.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: right;">2030</td><td style = "text-align: left;">AUS_SunPV</td><td style = "text-align: right;">2</td><td style = "text-align: right;">0.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: right;">2030</td><td style = "text-align: left;">AUS_SunPV</td><td style = "text-align: right;">3</td><td style = "text-align: right;">0.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: right;">2030</td><td style = "text-align: left;">AUS_SunPV</td><td style = "text-align: right;">4</td><td style = "text-align: right;">0.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">5</td><td style = "text-align: right;">2030</td><td style = "text-align: left;">AUS_SunPV</td><td style = "text-align: right;">5</td><td style = "text-align: right;">0.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">6</td><td style = "text-align: right;">2030</td><td style = "text-align: left;">AUS_SunPV</td><td style = "text-align: right;">6</td><td style = "text-align: right;">0.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">7</td><td style = "text-align: right;">2030</td><td style = "text-align: left;">AUS_SunPV</td><td style = "text-align: right;">7</td><td style = "text-align: right;">0.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">8</td><td style = "text-align: right;">2030</td><td style = "text-align: left;">AUS_SunPV</td><td style = "text-align: right;">8</td><td style = "text-align: right;">0.01</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">9</td><td style = "text-align: right;">2030</td><td style = "text-align: left;">AUS_SunPV</td><td style = "text-align: right;">9</td><td style = "text-align: right;">0.088</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">10</td><td style = "text-align: right;">2030</td><td style = "text-align: left;">AUS_SunPV</td><td style = "text-align: right;">10</td><td style = "text-align: right;">0.107</td></tr></tbody></table></div><p>Let&#39;s explore the first 10 unique profile names in the <code>profiles</code> table:</p><pre><code class="language-julia hljs">nice_query(&quot;&quot;&quot;
    SELECT DISTINCT profile_name
    FROM profiles
    ORDER BY profile_name
    LIMIT 10
&quot;&quot;&quot;)</code></pre><div><div style = "float: left;"><span>10√ó1 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">profile_name</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "String" style = "text-align: left;">String</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: left;">AUS_SunPV</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: left;">AUS_WindOff</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: left;">AUS_WindOn</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: left;">AUS_demand</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">5</td><td style = "text-align: left;">BEL_SunPV</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">6</td><td style = "text-align: left;">BEL_WindOff</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">7</td><td style = "text-align: left;">BEL_WindOn</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">8</td><td style = "text-align: left;">BEL_demand</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">9</td><td style = "text-align: left;">BLK_SunPV</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">10</td><td style = "text-align: left;">BLK_WindOff</td></tr></tbody></table></div><p>And finally, we can use <code>nice_query</code> to filter the profiles and plot them. For example, here we filter and plot the profiles in the Netherlands (i.e., those starting with <code>NED_</code>) and plot only a sample with the profiles for the first week of the year:</p><pre><code class="language-julia hljs">using Plots

df = nice_query(&quot;&quot;&quot;
    SELECT *
    FROM profiles
    WHERE profile_name LIKE &#39;NED_%&#39;
    ORDER BY profile_name, timestep
&quot;&quot;&quot;)

sample = 1:168
plot(size=(800, 400))
for group in groupby(df, :profile_name)
    name = group.profile_name[1]
    plot!(group.timestep[sample], group.value[sample], label=name)
end
plot!(xlabel=&quot;Timestep&quot;, ylabel=&quot;Value&quot;, title=&quot;Profiles in the Netherlands&quot;)</code></pre><img src="085340ec.svg" alt="Example block output"/><h3 id="Clustering"><a class="docs-heading-anchor" href="#Clustering">Clustering</a><a id="Clustering-1"></a><a class="docs-heading-anchor-permalink" href="#Clustering" title="Permalink"></a></h3><p>We can perform the clustering by using the <a href="../95-reference/#TulipaClustering.cluster!-Tuple{Any, Any, Any}"><code>cluster!</code></a> function by passing the connection with the profiles table and two extra arguments (see <a href="../20-concepts/#concepts">Concepts</a> for their deeped meaning):</p><ul><li><code>period_duration</code>: How long are the periods (e.g., 24 for daily periods if the timestep is hourly);</li><li><code>num_rps</code>: How many representative periods.</li></ul><p>In this example we use the function <a href="../95-reference/#TulipaClustering.cluster!-Tuple{Any, Any, Any}"><code>cluster!</code></a> with its default parameters. Section <a href="#hull_clustering">Hull Clustering with Blended Representative Periods</a> explains the extra parameters that can be passed to the clustering function.</p><p>Finally, it will create new output tables in the DuckDB connection that we will explore in the next section.</p><p>After the clustering, four tables will be created in the DuckDB connection:</p><pre><code class="language-julia hljs">using TulipaClustering

period_duration = 24
num_rps = 4


clusters = cluster!(connection, period_duration, num_rps)

nice_query(&quot;SHOW tables&quot;)</code></pre><div><div style = "float: left;"><span>5√ó1 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">name</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "String" style = "text-align: left;">String</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: left;">profiles</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: left;">profiles_rep_periods</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: left;">rep_periods_data</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: left;">rep_periods_mapping</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">5</td><td style = "text-align: left;">timeframe_data</td></tr></tbody></table></div><h3 id="Output-Tables"><a class="docs-heading-anchor" href="#Output-Tables">Output Tables</a><a id="Output-Tables-1"></a><a class="docs-heading-anchor-permalink" href="#Output-Tables" title="Permalink"></a></h3><p>The output tables are:</p><ul><li><code>profiles_rep_periods</code> contains the profiles for each RP,</li></ul><pre><code class="language-julia hljs">nice_query(&quot;FROM profiles_rep_periods LIMIT 5&quot;)</code></pre><div><div style = "float: left;"><span>5√ó5 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">rep_period</th><th style = "text-align: left;">timestep</th><th style = "text-align: left;">year</th><th style = "text-align: left;">profile_name</th><th style = "text-align: left;">value</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "String" style = "text-align: left;">String</th><th title = "Float64" style = "text-align: left;">Float64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">2030</td><td style = "text-align: left;">AUS_SunPV</td><td style = "text-align: right;">0.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: right;">1</td><td style = "text-align: right;">2</td><td style = "text-align: right;">2030</td><td style = "text-align: left;">AUS_SunPV</td><td style = "text-align: right;">0.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: right;">1</td><td style = "text-align: right;">3</td><td style = "text-align: right;">2030</td><td style = "text-align: left;">AUS_SunPV</td><td style = "text-align: right;">0.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: right;">1</td><td style = "text-align: right;">4</td><td style = "text-align: right;">2030</td><td style = "text-align: left;">AUS_SunPV</td><td style = "text-align: right;">0.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">5</td><td style = "text-align: right;">1</td><td style = "text-align: right;">5</td><td style = "text-align: right;">2030</td><td style = "text-align: left;">AUS_SunPV</td><td style = "text-align: right;">0.0</td></tr></tbody></table></div><ul><li><code>rep_periods_data</code> contains the general informations of the RPs,</li></ul><pre><code class="language-julia hljs">nice_query(&quot;FROM rep_periods_data&quot;)</code></pre><div><div style = "float: left;"><span>4√ó4 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">year</th><th style = "text-align: left;">rep_period</th><th style = "text-align: left;">num_timesteps</th><th style = "text-align: left;">resolution</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Float64" style = "text-align: left;">Float64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: right;">2030</td><td style = "text-align: right;">1</td><td style = "text-align: right;">24</td><td style = "text-align: right;">1.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: right;">2030</td><td style = "text-align: right;">2</td><td style = "text-align: right;">24</td><td style = "text-align: right;">1.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: right;">2030</td><td style = "text-align: right;">3</td><td style = "text-align: right;">24</td><td style = "text-align: right;">1.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: right;">2030</td><td style = "text-align: right;">4</td><td style = "text-align: right;">24</td><td style = "text-align: right;">1.0</td></tr></tbody></table></div><ul><li><code>rep_periods_mapping</code> containts the weights that are use to map the RPs to the original (or base) periods,</li></ul><pre><code class="language-julia hljs">nice_query(&quot;FROM rep_periods_mapping LIMIT 5&quot;)</code></pre><div><div style = "float: left;"><span>5√ó4 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">year</th><th style = "text-align: left;">period</th><th style = "text-align: left;">rep_period</th><th style = "text-align: left;">weight</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Float64" style = "text-align: left;">Float64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: right;">2030</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: right;">2030</td><td style = "text-align: right;">2</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: right;">2030</td><td style = "text-align: right;">3</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: right;">2030</td><td style = "text-align: right;">4</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">5</td><td style = "text-align: right;">2030</td><td style = "text-align: right;">5</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1.0</td></tr></tbody></table></div><ul><li><code>timeframe_data</code> contains information about the original (or base) periods</li></ul><pre><code class="language-julia hljs">nice_query(&quot;FROM timeframe_data LIMIT 5&quot;)</code></pre><div><div style = "float: left;"><span>5√ó3 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">year</th><th style = "text-align: left;">period</th><th style = "text-align: left;">num_timesteps</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Int64" style = "text-align: left;">Int64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: right;">2030</td><td style = "text-align: right;">1</td><td style = "text-align: right;">24</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: right;">2030</td><td style = "text-align: right;">2</td><td style = "text-align: right;">24</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: right;">2030</td><td style = "text-align: right;">3</td><td style = "text-align: right;">24</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: right;">2030</td><td style = "text-align: right;">4</td><td style = "text-align: right;">24</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">5</td><td style = "text-align: right;">2030</td><td style = "text-align: right;">5</td><td style = "text-align: right;">24</td></tr></tbody></table></div><p>You can use DuckDB to explore the results using SQL queries or export them to CSV or Parquet files using DuckDB&#39;s <a href="https://duckdb.org/docs/stable/guides/file_formats/overview">writers</a>.</p><p>For example, we can plot again the profiles in the Netherlands, but this time using the clustered profiles:</p><pre><code class="language-julia hljs">df = nice_query(&quot;&quot;&quot;
    SELECT *
    FROM profiles_rep_periods
    WHERE profile_name LIKE &#39;NED_%&#39;
    ORDER BY profile_name, timestep
&quot;&quot;&quot;)
rep_periods = unique(df.rep_period)
plots = []

for rp in rep_periods
    df_rp = filter(row -&gt; row.rep_period == rp, df)
    p = plot(size=(400, 300), title=&quot;Representative Period $rp&quot;)

    for group in groupby(df_rp, :profile_name)
        name = group.profile_name[1]
        plot!(p, group.timestep, group.value, label=name)
    end

    show_legend = (rp == rep_periods[1])
    plot!(p,
          xlabel=&quot;Timestep&quot;,
          ylabel=&quot;Value&quot;,
          xticks=0:2:period_duration,
          xlim=(1, period_duration),
          ylim=(0, 1),
          legend=show_legend ? :bottomleft : false,
          legendfontsize=6
         )
    push!(plots, p)
end

plot(plots..., layout=(2, 2), size=(800, 600))</code></pre><img src="ced15a83.svg" alt="Example block output"/><p>üéâ Congratulations! You have successfully finished the first part of the tutorial. Now you can continue with more concepts and options in the following sections üòâ</p><h2 id="hull_clustering"><a class="docs-heading-anchor" href="#hull_clustering">Hull Clustering with Blended Representative Periods</a><a id="hull_clustering-1"></a><a class="docs-heading-anchor-permalink" href="#hull_clustering" title="Permalink"></a></h2><p>The function <a href="../95-reference/#TulipaClustering.cluster!-Tuple{Any, Any, Any}"><code>cluster!</code></a> has several keyword arguments that can be used to customize the clustering process. Alternatively, you can use the help mode in Julia REPL by typing <code>?cluster!</code> to see all the available keyword arguments and their descriptions. Here is a summary of the most important keyword arguments for this tutorial:</p><ul><li><code>method</code> (default <code>:k_medoids</code>): clustering method to use <code>:k_means</code>, <code>:k_medoids</code>, <code>:convex_hull</code>, <code>:convex_hull_with_null</code>, or <code>:conical_hull</code>.</li><li><code>distance</code> (default <code>Distances.Euclidean()</code>): semimetric used to measure distance between data points from the the package Distances.jl.</li><li><code>weight_type</code> (default <code>:dirac</code>): the type of weights to find; possible values are:<ul><li><code>:dirac</code>: each period is represented by exactly one representative period (a one unit weight and the rest are zeros)</li><li><code>:convex</code>: each period is represented as a convex sum of the representative periods (a sum with nonnegative weights adding into one)</li><li><code>:conical</code>: each period is represented as a conical sum of the representative periods (a sum with nonnegative weights)</li><li><code>:conical_bounded</code>: each period is represented as a conical sum of the representative periods (a sum with nonnegative weights) with the total weight bounded from above by one.</li></ul></li></ul><p>As you can see, there are several keyword arguments that can be combined to explore different clustering strategies. Our proposed method is the Hull Clustering with Blended Representative Periods, which can be activated by setting the following keyword arguments:</p><ul><li><code>method = :convex_hull</code></li><li><code>distance = Distances.CosineDist()</code></li><li><code>weight_type = :convex</code></li></ul><p>You can read more about the proposed method in the <a href="../20-concepts/#concepts">Concepts</a> section.</p><p>So, let&#39;s cluster again using the proposed method:</p><pre><code class="language-julia hljs">using Distances
clusters = cluster!(connection,
                    period_duration,
                    num_rps;
                    method = :convex_hull,
                    distance = Distances.CosineDist(),
                    weight_type = :convex
                    )

nice_query(&quot;SHOW tables&quot;)</code></pre><div><div style = "float: left;"><span>5√ó1 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">name</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "String" style = "text-align: left;">String</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: left;">profiles</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: left;">profiles_rep_periods</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: left;">rep_periods_data</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: left;">rep_periods_mapping</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">5</td><td style = "text-align: left;">timeframe_data</td></tr></tbody></table></div><p>As you can see, the output tables names are the same as before, but the results will be different. You can explore the results again using SQL queries or export them to CSV or Parquet files using DuckDB&#39;s <a href="https://duckdb.org/docs/stable/guides/file_formats/overview">writers</a>.</p><p>Let&#39;s plot again the profiles in the Netherlands, but this time using the clustered profiles with the hull clustering method:</p><pre><code class="language-julia hljs">df = nice_query(&quot;&quot;&quot;
    SELECT *
    FROM profiles_rep_periods
    WHERE profile_name LIKE &#39;NED_%&#39;
    ORDER BY profile_name, timestep
&quot;&quot;&quot;)
rep_periods = unique(df.rep_period)
plots = []

for rp in rep_periods
    df_rp = filter(row -&gt; row.rep_period == rp, df)
    p = plot(size=(400, 300), title=&quot;Hull Clustering RP $rp&quot;)

    for group in groupby(df_rp, :profile_name)
        name = group.profile_name[1]
        plot!(p, group.timestep, group.value, label=name)
    end

    show_legend = (rp == rep_periods[1])
    plot!(p,
          xlabel=&quot;Timestep&quot;,
          ylabel=&quot;Value&quot;,
          xticks=0:2:period_duration,
          xlim=(1, period_duration),
          ylim=(0, 1),
          legend=show_legend ? :topleft : false,
          legendfontsize=6
         )
    push!(plots, p)
end

plot(plots..., layout=(2, 2), size=(800, 600))</code></pre><img src="030645ea.svg" alt="Example block output"/><p>The first difference you may notice is that the representative periods (RPs) obtained with hull clustering are more extreme than those obtained with the default method. This is because hull clustering selects RPs that are more likely to be constraint-binding in an optimization model.</p><div class="admonition is-success" id="The-Projected-gradient-descent-parameters-f2e66515ef00bdea"><header class="admonition-header">The Projected gradient descent parameters<a class="admonition-anchor" href="#The-Projected-gradient-descent-parameters-f2e66515ef00bdea" title="Permalink"></a></header><div class="admonition-body"><p>The parameters <code>niters</code> and <code>learning_rate</code> tell for how many iterations to run the descent and by how much to adjust the weights in each iterations. More iterations make the method slower but produce better results. Larger learning rate makes the method converge faster but in a less stable manner (i.e., weights might start going up and down a lot from iteration to iteration). Sometimes you need to find the right balance for yourself. In general, if the weights produced by the method look strange, try decreasing the learning rate and/or increasing the number of iterations.</p></div></div><p>For more details on the comparison of clustering methods please refer to the <a href="../80-scientific-references/#scientific-refs">Scientific References</a> section.</p><h2 id="Clustering-by-other-columns"><a class="docs-heading-anchor" href="#Clustering-by-other-columns">Clustering by other columns</a><a id="Clustering-by-other-columns-1"></a><a class="docs-heading-anchor-permalink" href="#Clustering-by-other-columns" title="Permalink"></a></h2><p><code>TulipaClustering.jl</code> clusters by default using the columns <code>year</code>, i.e., it will create representative periods for each year in the input data. The total number of representative periods will be <code>num_rps * number_of_years</code>. This is useful when the profiles have a strong seasonal component that changes from year to year.</p><p>However, sometimes the user might want to cluster by other columns, e.g., <code>scenario</code> or <code>region</code>, or even by multiple columns, e.g., <code>year</code> and <code>scenario</code>. The package allows to cluster by different columns by passing a custom <a href="../95-reference/#TulipaClustering.ProfilesTableLayout"><code>ProfilesTableLayout</code></a> to <a href="../95-reference/#TulipaClustering.cluster!-Tuple{Any, Any, Any}"><code>cluster!</code></a>.</p><div class="admonition is-warning" id="Required-60995c5846286401"><header class="admonition-header">Required<a class="admonition-anchor" href="#Required-60995c5846286401" title="Permalink"></a></header><div class="admonition-body"><p>The <code>cols_to_groupby</code> argument in <a href="../95-reference/#TulipaClustering.ProfilesTableLayout"><code>ProfilesTableLayout</code></a> is a vector of symbols, i.e., <code>cols_to_groupby = [:year, :scenario]</code>.</p></div></div><div class="admonition is-info" id="The-number-of-representative-periods-bf4b1be00e1c941b"><header class="admonition-header">The number of representative periods<a class="admonition-anchor" href="#The-number-of-representative-periods-bf4b1be00e1c941b" title="Permalink"></a></header><div class="admonition-body"><p>When clustering by multiple columns, the total number of representative periods will be <code>num_rps * number_of_unique_combinations_of_groupby_columns</code>. For example, if the input data has 3 unique years and 2 unique scenarios, and the user wants to cluster by <code>year</code> and <code>scenario</code>, then the total number of representative periods will be <code>num_rps * 3 * 2 = num_rps * 6</code>.</p></div></div><h2 id="custom_layout"><a class="docs-heading-anchor" href="#custom_layout">Using a Custom Layout</a><a id="custom_layout-1"></a><a class="docs-heading-anchor-permalink" href="#custom_layout" title="Permalink"></a></h2><p>Let&#39;s say that you have a table that uses different names for the columns of your data. For example, let&#39;s rename the column <code>timestep</code> to <code>hour</code> in the profiles table.</p><pre><code class="language-julia hljs">DuckDB.query(
  connection,
  &quot;ALTER TABLE profiles
   RENAME COLUMN timestep to hour;
  &quot;,
)

nice_query(&quot;FROM profiles LIMIT 10&quot;)</code></pre><div><div style = "float: left;"><span>10√ó4 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">year</th><th style = "text-align: left;">profile_name</th><th style = "text-align: left;">hour</th><th style = "text-align: left;">value</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "String" style = "text-align: left;">String</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Float64" style = "text-align: left;">Float64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: right;">2030</td><td style = "text-align: left;">AUS_SunPV</td><td style = "text-align: right;">1</td><td style = "text-align: right;">0.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: right;">2030</td><td style = "text-align: left;">AUS_SunPV</td><td style = "text-align: right;">2</td><td style = "text-align: right;">0.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: right;">2030</td><td style = "text-align: left;">AUS_SunPV</td><td style = "text-align: right;">3</td><td style = "text-align: right;">0.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: right;">2030</td><td style = "text-align: left;">AUS_SunPV</td><td style = "text-align: right;">4</td><td style = "text-align: right;">0.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">5</td><td style = "text-align: right;">2030</td><td style = "text-align: left;">AUS_SunPV</td><td style = "text-align: right;">5</td><td style = "text-align: right;">0.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">6</td><td style = "text-align: right;">2030</td><td style = "text-align: left;">AUS_SunPV</td><td style = "text-align: right;">6</td><td style = "text-align: right;">0.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">7</td><td style = "text-align: right;">2030</td><td style = "text-align: left;">AUS_SunPV</td><td style = "text-align: right;">7</td><td style = "text-align: right;">0.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">8</td><td style = "text-align: right;">2030</td><td style = "text-align: left;">AUS_SunPV</td><td style = "text-align: right;">8</td><td style = "text-align: right;">0.01</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">9</td><td style = "text-align: right;">2030</td><td style = "text-align: left;">AUS_SunPV</td><td style = "text-align: right;">9</td><td style = "text-align: right;">0.088</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">10</td><td style = "text-align: right;">2030</td><td style = "text-align: left;">AUS_SunPV</td><td style = "text-align: right;">10</td><td style = "text-align: right;">0.107</td></tr></tbody></table></div><p>In this case, you can use the custom column name by passing a <a href="../95-reference/#TulipaClustering.ProfilesTableLayout"><code>ProfilesTableLayout</code></a> to <a href="../95-reference/#TulipaClustering.cluster!-Tuple{Any, Any, Any}"><code>cluster!</code></a>.</p><p>The layout names will also be preserved in the output tables. Below we cluster again, but ask passing the information to use <code>hour</code> instead of the default <code>timestep</code>:</p><pre><code class="language-julia hljs">layout = TulipaClustering.ProfilesTableLayout(; timestep = :hour)
clusters = cluster!(connection, period_duration, num_rps; layout)

nice_query(&quot;FROM profiles_rep_periods LIMIT 10&quot;)</code></pre><div><div style = "float: left;"><span>10√ó5 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">rep_period</th><th style = "text-align: left;">hour</th><th style = "text-align: left;">year</th><th style = "text-align: left;">profile_name</th><th style = "text-align: left;">value</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "String" style = "text-align: left;">String</th><th title = "Float64" style = "text-align: left;">Float64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">2030</td><td style = "text-align: left;">AUS_SunPV</td><td style = "text-align: right;">0.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: right;">1</td><td style = "text-align: right;">2</td><td style = "text-align: right;">2030</td><td style = "text-align: left;">AUS_SunPV</td><td style = "text-align: right;">0.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: right;">1</td><td style = "text-align: right;">3</td><td style = "text-align: right;">2030</td><td style = "text-align: left;">AUS_SunPV</td><td style = "text-align: right;">0.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: right;">1</td><td style = "text-align: right;">4</td><td style = "text-align: right;">2030</td><td style = "text-align: left;">AUS_SunPV</td><td style = "text-align: right;">0.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">5</td><td style = "text-align: right;">1</td><td style = "text-align: right;">5</td><td style = "text-align: right;">2030</td><td style = "text-align: left;">AUS_SunPV</td><td style = "text-align: right;">0.001</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">6</td><td style = "text-align: right;">1</td><td style = "text-align: right;">6</td><td style = "text-align: right;">2030</td><td style = "text-align: left;">AUS_SunPV</td><td style = "text-align: right;">0.075</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">7</td><td style = "text-align: right;">1</td><td style = "text-align: right;">7</td><td style = "text-align: right;">2030</td><td style = "text-align: left;">AUS_SunPV</td><td style = "text-align: right;">0.237</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">8</td><td style = "text-align: right;">1</td><td style = "text-align: right;">8</td><td style = "text-align: right;">2030</td><td style = "text-align: left;">AUS_SunPV</td><td style = "text-align: right;">0.404</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">9</td><td style = "text-align: right;">1</td><td style = "text-align: right;">9</td><td style = "text-align: right;">2030</td><td style = "text-align: left;">AUS_SunPV</td><td style = "text-align: right;">0.544</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">10</td><td style = "text-align: right;">1</td><td style = "text-align: right;">10</td><td style = "text-align: right;">2030</td><td style = "text-align: left;">AUS_SunPV</td><td style = "text-align: right;">0.649</td></tr></tbody></table></div><p>Notice the column <code>hour</code> in the output above (instead of <code>timestep</code>).</p><h2 id="Extra-Functions-in-High-level-API/DuckDB-API"><a class="docs-heading-anchor" href="#Extra-Functions-in-High-level-API/DuckDB-API">Extra Functions in High level API/DuckDB API</a><a id="Extra-Functions-in-High-level-API/DuckDB-API-1"></a><a class="docs-heading-anchor-permalink" href="#Extra-Functions-in-High-level-API/DuckDB-API" title="Permalink"></a></h2><p>The high-level API of TulipaClustering focuses on using TulipaClustering as part of the <a href="https://tulipaenergy.github.io/TulipaEnergyModel.jl/stable/">Tulipa workflow</a>. This API consists of three main functions: <a href="../95-reference/#TulipaClustering.cluster!-Tuple{Any, Any, Any}"><code>cluster!</code></a>, <a href="../95-reference/#TulipaClustering.transform_wide_to_long!-Tuple{Any, Any, Any}"><code>transform_wide_to_long!</code></a>, and <a href="../95-reference/#TulipaClustering.dummy_cluster!-Tuple{Any}"><code>dummy_cluster!</code></a>. These functions are designed to work with DuckDB connections and tables, making it easy to integrate clustering into your data processing pipeline. In the previous sections, we have already covered the usage of <a href="../95-reference/#TulipaClustering.cluster!-Tuple{Any, Any, Any}"><code>cluster!</code></a> and <a href="../95-reference/#TulipaClustering.transform_wide_to_long!-Tuple{Any, Any, Any}"><code>transform_wide_to_long!</code></a>. In this section, we will explore the third function, <a href="../95-reference/#TulipaClustering.dummy_cluster!-Tuple{Any}"><code>dummy_cluster!</code></a>, which is useful for testing, debugging, and to prepare the data for TulipaEnergyModel without actually clustering the profiles.</p><h3 id="Dummy-Clustering"><a class="docs-heading-anchor" href="#Dummy-Clustering">Dummy Clustering</a><a id="Dummy-Clustering-1"></a><a class="docs-heading-anchor-permalink" href="#Dummy-Clustering" title="Permalink"></a></h3><p>A dummy cluster will essentially ignore the clustering, but it will create the necessary tables that are often used for the next steps in the <a href="https://tulipaenergy.github.io/TulipaEnergyModel.jl/stable/">Tulipa workflow</a>.</p><pre><code class="language-julia hljs">clusters = dummy_cluster!(connection; layout)

nice_query(&quot;FROM rep_periods_data LIMIT 10&quot;)</code></pre><div><div style = "float: left;"><span>1√ó4 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">year</th><th style = "text-align: left;">rep_period</th><th style = "text-align: left;">num_timesteps</th><th style = "text-align: left;">resolution</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Float64" style = "text-align: left;">Float64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: right;">2030</td><td style = "text-align: right;">1</td><td style = "text-align: right;">8760</td><td style = "text-align: right;">1.0</td></tr></tbody></table></div><p>In this case the function created a single representative period for all the data.</p><p>Notice that we passed the <code>layout</code> argument to <a href="../95-reference/#TulipaClustering.dummy_cluster!-Tuple{Any}"><code>dummy_cluster!</code></a> to ensure that the output tables have the correct column names, since we renamed the <code>timestep</code> column to <code>hour</code> in the previous section.</p><h3 id="Transform-a-wide-profiles-table-into-a-long-table"><a class="docs-heading-anchor" href="#Transform-a-wide-profiles-table-into-a-long-table">Transform a wide profiles table into a long table</a><a id="Transform-a-wide-profiles-table-into-a-long-table-1"></a><a class="docs-heading-anchor-permalink" href="#Transform-a-wide-profiles-table-into-a-long-table" title="Permalink"></a></h3><div class="admonition is-warning" id="Required-c47b200759f884ae"><header class="admonition-header">Required<a class="admonition-anchor" href="#Required-c47b200759f884ae" title="Permalink"></a></header><div class="admonition-body"><p>The long table format is a requirement of TulipaClustering, even for the dummy clustering example.</p></div></div><p>A long table is a table where the profile names are stacked in a column with the corresponding values in a separate column. However, sometimes the input data is in a wide format, i.e., each profile is in a separate column.</p><p>In those cases, you can use the function <a href="../95-reference/#TulipaClustering.transform_wide_to_long!-Tuple{Any, Any, Any}"><code>transform_wide_to_long!</code></a> to transform a wide table into a long table. You need to provide the connection to DuckDB, the name of the source table (the wide table) and the name of the target table (the long table that will be created).</p><h2 id="Low-level-API"><a class="docs-heading-anchor" href="#Low-level-API">Low level API</a><a id="Low-level-API-1"></a><a class="docs-heading-anchor-permalink" href="#Low-level-API" title="Permalink"></a></h2><p>The <a href="../95-reference/#TulipaClustering.cluster!-Tuple{Any, Any, Any}"><code>cluster!</code></a> function is a wrapper around the low-level clustering functions. It simplifies the process of clustering by handling the creation of temporary tables and managing the clustering workflow.</p><p>However, if you want to have more control over the clustering process, you can use the low-level functions directly. The low-level API consists of the following functions:</p><ul><li><a href="../95-reference/#TulipaClustering.split_into_periods!-Tuple{DataFrames.AbstractDataFrame}"><code>split_into_periods!</code></a>: Splits the profiles into periods based on the specified period duration.</li><li><a href="../95-reference/#TulipaClustering.find_representative_periods-Tuple{DataFrames.AbstractDataFrame, Int64}"><code>find_representative_periods</code></a>: Finds the representative periods using the specified clustering method.</li><li><a href="../95-reference/#TulipaClustering.fit_rep_period_weights!-Tuple{TulipaClustering.ClusteringResult}"><code>fit_rep_period_weights!</code></a>: Fits the weights for the representative periods to map them to the original periods.</li></ul><p>At the end of the clustering process, you will get a <a href="../95-reference/#TulipaClustering.ClusteringResult"><code>TulipaClustering.ClusteringResult</code></a> struct that contains the detailed results of the clustering process:</p><ul><li><code>profiles</code> is a dataframe with profiles for RPs,</li><li><code>weight_matrix</code> is a matrix of weights of RPs in blended periods,</li><li><code>clustering_matrix</code> and <code>rp_matrix</code> are matrices of profile data for each base and representative period (useful to keep for the next step, but you should not need these unless you want to do some extra math here)</li><li><code>auxiliary_data</code> contains some extra data that was generated during the clustering process and is generally not interesting to the user who is not planning to interact with the clustering method on a very low level. For example, if you use the <code>k-medoids</code> method, the <code>auxiliary_data</code> will contain the indices of the medoids in the original data.</li></ul><p>So, although we recommend using the high-level API for most use cases, you can use the low-level functions if you need more control over the clustering process.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">¬´ Welcome</a><a class="docs-footer-nextpage" href="../20-concepts/">Concepts ¬ª</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Wednesday 26 November 2025 11:49">Wednesday 26 November 2025</span>. Using Julia version 1.12.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
